import PageWithMultipleCards from "../../components/layouts/PageWithMultipleCards";
import TitleWithInfo from "../../components/shared/TitleWithInfo";
import FilterComponent from "./components/FilterComponent";
import {HorizontalGrid} from "@shopify/polaris";
import jsYaml from 'js-yaml';

function ConfigureExploitsPage() {


    const validateExploitCategory = (data) => {
        try {
            // Parse the YAML content
            const yamlContent = jsYaml.load(data);

            // Check if the category name is SuccessfulExploit
            const categoryName = yamlContent?.info?.category?.name;

            if (!categoryName) {
                return {
                    isValid: false,
                    errorMessage: "Category name is missing. Please ensure 'info.category.name' is defined in the YAML."
                };
            }

            if (categoryName !== "SuccessfulExploit") {
                return {
                    isValid: false,
                    errorMessage: `Category name must be 'SuccessfulExploit' for exploit configurations. Current value: '${categoryName}'`
                };
            }

            return { isValid: true };

        } catch (error) {
            return {
                isValid: false,
                errorMessage: `Invalid YAML format: ${error.message}`
            };
        }
    };

    const horizontalComponent = <HorizontalGrid columns={1} gap={2}>
        <FilterComponent
            key={"filter-component"}
            includeCategoryNameEquals={"SuccessfulExploit"}
            titleText={"Successful exploits"}
            readOnly={false}
            validateOnSave={validateExploitCategory}
        />
    </HorizontalGrid>

    const components = [
        horizontalComponent,
    ]

    return <PageWithMultipleCards
        title={
            <TitleWithInfo
                titleText={"Configure Successful Exploits"}
                tooltipContent={"Manage exploit configurations and detection behavior"}
            />
        }
        isFirstPage={true}
        components={components}
    />
}

export default ConfigureExploitsPage;
